<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="description" content="rict">
<title>Tech demo: Temperature change • rict</title>
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.2.2/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.2.2/bootstrap.bundle.min.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- bootstrap-toc --><script src="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@v1.0.1/dist/bootstrap-toc.min.js" integrity="sha256-4veVQbu7//Lk5TSmc7YV48MxtMy98e26cf5MrgZYnwo=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- search --><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Tech demo: Temperature change">
<meta property="og:description" content="rict">
<meta name="robots" content="noindex">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>
    

    <nav class="navbar fixed-top navbar-light navbar-expand-lg bg-light"><div class="container">
    
    <a class="navbar-brand me-2" href="../index.html">rict</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">3.1.5</small>

    
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item">
  <a class="nav-link" href="../reference/index.html">Reference</a>
</li>
<li class="active nav-item dropdown">
  <a href="#" class="nav-link dropdown-toggle" data-bs-toggle="dropdown" role="button" aria-expanded="false" aria-haspopup="true" id="dropdown-articles">Articles</a>
  <div class="dropdown-menu" aria-labelledby="dropdown-articles">
    <a class="dropdown-item" href="../articles/functional-specification.html">River Invertebrate Classification Tool (RICT) Functional Specification</a>
    <a class="dropdown-item" href="../articles/tech-demo-temperature-change.html">Tech demo: Temperature change</a>
    <a class="dropdown-item" href="../articles/user-guide.html">User Guide</a>
  </div>
</li>
      </ul>
<form class="form-inline my-2 my-lg-0" role="search">
        <input type="search" class="form-control me-sm-2" aria-label="Toggle navigation" name="search-input" data-search-index="../search.json" id="search-input" placeholder="Search for" autocomplete="off">
</form>

      <ul class="navbar-nav">
<li class="nav-item">
  <a class="external-link nav-link" href="https://github.com/aquaMetrics/rict/" aria-label="github">
    <span class="fab fa fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>

    
  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="" class="logo" alt=""><h1>Tech demo: Temperature change</h1>
                        <h4 data-toc-skip class="author">Tim Foster</h4>
            
            <h4 data-toc-skip class="date">2023-07-06</h4>
      
      <small class="dont-index">Source: <a href="https://github.com/aquaMetrics/rict/blob/HEAD/vignettes/tech-demo-temperature-change.Rmd" class="external-link"><code>vignettes/tech-demo-temperature-change.Rmd</code></a></small>
      <div class="d-none name"><code>tech-demo-temperature-change.Rmd</code></div>
    </div>

    
    
<div class="section level3">
<h3 id="intro">Intro<a class="anchor" aria-label="anchor" href="#intro"></a>
</h3>
<p>This is a quick example to demonstrate how the <code>rict</code>
package can be used to simulate the affect of temperature changes. You
will see how to:</p>
<ol style="list-style-type: decimal">
<li>Update the input dataset</li>
<li>Simulate changes to a predictive variables</li>
<li>Predict and classify simulations</li>
<li>Graph and interpret results</li>
</ol>
</div>
<div class="section level3">
<h3 id="setup">Setup<a class="anchor" aria-label="anchor" href="#setup"></a>
</h3>
<p>If you don’t have R installed on your local machine, try using <a href="https://rstudio.cloud/" class="external-link">Rstudio Cloud</a> website to run R in your
web browser - it’s quick and free to sign-up.</p>
<p>Before starting, make sure to have the required packages installed in
RStudio. We are going to use <code>tidyverse</code> and
<code>rict</code> packages:</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/aquaMetrics/rict" class="external-link">rict</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://tidyverse.tidyverse.org" class="external-link">tidyverse</a></span><span class="op">)</span></span></code></pre></div>
<p><strong>NOTE: If these packages fail to load, follow this <a href="https://moderndive.netlify.app/1-3-packages.html" class="external-link">example</a>
(replacing <code>ggplot2</code> with <code>tidyverse</code>)
<em>and</em> follow this separate <a href="https://github.com/aquaMetrics/rict#install" class="external-link">guide</a> to
installing <code>rict</code>.</strong></p>
</div>
<div class="section level3">
<h3 id="run-predictions">Run Predictions<a class="anchor" aria-label="anchor" href="#run-predictions"></a>
</h3>
<p>Use the <code>rict_predict</code> function to calculate a set of
predictions. We can make predictions based on the demo input data
(<code>demo_observed_values</code>) which is available to use when the
<code>rict</code> library is loaded.</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">predictions</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/rict_predict.html">rict_predict</a></span><span class="op">(</span><span class="va">demo_observed_values</span><span class="op">)</span></span></code></pre></div>
<p>The <code>predictions</code> output includes biological indices
predictions as well as the reference temperature values used in the
prediction (<code>MEAN.AIR.TEMP</code> and <code>AIR.TEMP.RANGE</code>
columns). Behind the scenes, the Grid Reference is used to find the
temperature values from a large file of 1km grid-square temperature
values for Great Britain stored in the <code>rict</code> package.</p>
<p><strong>NOTE: The Northern Ireland model doesn’t use temperature as a
predictive variable.</strong></p>
</div>
<div class="section level3">
<h3 id="reference-temperature">Reference Temperature<a class="anchor" aria-label="anchor" href="#reference-temperature"></a>
</h3>
<p>Temperature values (mean temp and temp range) are one of a number of
variables (slope, altitude etc) used to predict the biological indices.
It’s useful to be able to look-up reference temperature values, however,
we only want the ‘reference’ temperature values as a starting point from
which we can slowly increment the temperature values to simulate
temperature increase.</p>
<p>To do this, we can include the temperature values as optional columns
in our demo input dataset. Usually, we don’t provide these columns as we
want <code>rict</code> to look-up these values, but if we do provide
these columns, <code>rict</code> will base the indices predictions on
the temperature values we provide.</p>
<p>Here we add the <code>MEAN.AIR.TEMP</code> and
<code>AIR.TEMP.RANGE</code> reference values from our predictions output
into our demo input dataset:</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">demo_observed_values</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/cbind.html" class="external-link">cbind</a></span><span class="op">(</span><span class="fu">rict</span><span class="fu">::</span><span class="va"><a href="../reference/demo_observed_values.html">demo_observed_values</a></span>,</span>
<span>  <span class="st">"MEAN.AIR.TEMP"</span> <span class="op">=</span> <span class="va">predictions</span><span class="op">$</span><span class="va">MEAN.AIR.TEMP</span>,</span>
<span>  <span class="st">"AIR.TEMP.RANGE"</span> <span class="op">=</span> <span class="va">predictions</span><span class="op">$</span><span class="va">AIR.TEMP.RANGE</span></span>
<span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="temperature-increments">Temperature Increments<a class="anchor" aria-label="anchor" href="#temperature-increments"></a>
</h3>
<p>We can now use the reference temperature values as a baseline and
slowly increase the temperature.</p>
<p>To do this, we create a list for increasing temperatures simulating a
0-2 degree rise in temperature with 0.2 increments.</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">temperature_increments</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">2</span>, <span class="fl">0.2</span><span class="op">)</span></span>
<span><span class="va">temperature_increments</span></span></code></pre></div>
<pre><code><span><span class="co">##  [1] 0.0 0.2 0.4 0.6 0.8 1.0 1.2 1.4 1.6 1.8 2.0</span></span></code></pre>
</div>
<div class="section level3">
<h3 id="simulate-temperature-increase">Simulate Temperature Increase<a class="anchor" aria-label="anchor" href="#simulate-temperature-increase"></a>
</h3>
<p>Here’s the big function: Loop through temperature increases and run
classification and predictions for each temperature increment.</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">modelled_temperatures</span> <span class="op">&lt;-</span> <span class="fu">map_df</span><span class="op">(</span><span class="va">temperature_increments</span>, <span class="kw">function</span><span class="op">(</span><span class="va">increment</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="va">demo_observed_values</span><span class="op">$</span><span class="va">MEAN.AIR.TEMP</span> <span class="op">&lt;-</span> <span class="va">demo_observed_values</span><span class="op">$</span><span class="va">MEAN.AIR.TEMP</span> <span class="op">+</span> <span class="va">increment</span></span>
<span>  <span class="va">demo_observed_values</span><span class="op">$</span><span class="va">AIR.TEMP.RANGE</span> <span class="op">&lt;-</span> <span class="va">demo_observed_values</span><span class="op">$</span><span class="va">AIR.TEMP.RANGE</span> <span class="op">+</span> <span class="va">increment</span></span>
<span>  <span class="va">predict_modelled</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/rict_predict.html">rict_predict</a></span><span class="op">(</span><span class="va">demo_observed_values</span><span class="op">)</span></span>
<span>  <span class="va">classify_modelled</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/rict_classify.html">rict_classify</a></span><span class="op">(</span><span class="va">predict_modelled</span>, year_type <span class="op">=</span> <span class="st">"single"</span><span class="op">)</span></span>
<span>  <span class="va">modelled</span> <span class="op">&lt;-</span> <span class="fu">inner_join</span><span class="op">(</span><span class="va">predict_modelled</span>, <span class="va">classify_modelled</span>, by <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"SITE"</span>, <span class="st">"YEAR"</span>, <span class="st">"WATERBODY"</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="co"># Add temperature increase column so we know which results match which temperature increment</span></span>
<span>  <span class="va">modelled</span><span class="op">$</span><span class="va">TEMP.INCREASE</span> <span class="op">&lt;-</span> <span class="va">increment</span></span>
<span>  <span class="va">modelled</span><span class="op">$</span><span class="va">SITE</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/character.html" class="external-link">as.character</a></span><span class="op">(</span><span class="va">modelled</span><span class="op">$</span><span class="va">SITE</span><span class="op">)</span></span>
<span>  <span class="kw"><a href="https://rdrr.io/r/base/function.html" class="external-link">return</a></span><span class="op">(</span><span class="va">modelled</span><span class="op">)</span></span>
<span><span class="op">}</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Filter on one year - to make results easier to display</span></span>
<span><span class="va">modelled_data</span> <span class="op">&lt;-</span> <span class="va">modelled_temperatures</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/stats/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">YEAR</span> <span class="op">==</span> <span class="fl">2016</span><span class="op">)</span></span></code></pre></div>
<p>The <code>map_df</code> function from the <code>tidyverse</code>
package, iterates over the <code>temperature_increments</code> values
and runs a function to return results for each <code>increment</code>.
For each loop/iteration the function will:</p>
<ul>
<li>Updates the temperature values by adding the
<code>increment</code>
</li>
<li>Run the <code>rict_predict</code> and <code>rict_classify</code>
functions</li>
<li>Join the prediction and classification outputs together using
<code>inner_join</code>
</li>
<li>Returns the <code>modelled</code> results in a dataframe</li>
</ul>
<p>For a deep-dive into iteration/loops and <code>map_df</code> type
functions, see this <a href="https://r4ds.had.co.nz/iteration.html" class="external-link">guide</a>.</p>
</div>
<div class="section level3">
<h3 id="results">Results<a class="anchor" aria-label="anchor" href="#results"></a>
</h3>
<p>Now we have the classification and predictions in a single dataframe,
we can review the results of our temperature simulation. We can plot the
average ASPT Spring and Autumn classification EQRs
(<code>ASPT_aver_spr_aut</code>) by each temperature increase. Note, the
higher the EQR value the ‘better’ the ecological status of the site.</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">ggplot</span><span class="op">(</span><span class="va">modelled_data</span>, <span class="fu">aes</span><span class="op">(</span>x <span class="op">=</span> <span class="va">TEMP.INCREASE</span>, y <span class="op">=</span> <span class="va">ASPT_aver_spr_aut</span>, color <span class="op">=</span> <span class="va">SITE</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">geom_line</span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<p><img src="tech-demo-temperature-change_files/figure-html/unnamed-chunk-7-1.png" width="700"></p>
<p>We can see the EQRs have a mixed response to increasing temperature.
Note, you can find more about <code>ggplot</code> functions and creating
plots with data in this <a href="https://ggplot2.tidyverse.org/" class="external-link">guide</a>.</p>
</div>
<div class="section level3">
<h3 id="confidence-in-simulation">Confidence in Simulation<a class="anchor" aria-label="anchor" href="#confidence-in-simulation"></a>
</h3>
<p>Can we really expect increasing temperature to affect EQRs in this
way? Are these simulated temperature increases beyond the scope of the
model and training data used to build the model? One way to provide a
partial answer this question, is to use the suitability code
(<code>suitcode</code>) provided in the predictions outputs. The
suitability code indicates if the input data is significantly different
from the data used to train the model (and therefore we are less
confident it can make accurate predictions). It assesses this on a scale
between 1-5, 1 - Low difference, 5 - High difference.</p>
<p>Here we select the suitability code and temperature increment to see
how the confidence in the input data suitability changes as temperature
increases:</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">select</span><span class="op">(</span><span class="va">modelled_data</span>, <span class="va">SITE</span>, <span class="va">TEMP.INCREASE</span>, <span class="va">SuitCode</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu">arrange</span><span class="op">(</span><span class="va">TEMP.INCREASE</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="fl">32</span><span class="op">)</span> <span class="co"># return the first 32 rows only</span></span></code></pre></div>
<pre><code><span><span class="co">##           SITE TEMP.INCREASE SuitCode</span></span>
<span><span class="co">## 1  MYR-GB-01-R           0.0        1</span></span>
<span><span class="co">## 2  MYR-GB-05-R           0.0        1</span></span>
<span><span class="co">## 3  MYR-GB-09-R           0.0        1</span></span>
<span><span class="co">## 4  MYR-GB-12-R           0.0        2</span></span>
<span><span class="co">## 5  MYR-GB-01-D           0.0        1</span></span>
<span><span class="co">## 6  MYR-GB-05-D           0.0        1</span></span>
<span><span class="co">## 7  MYR-GB-09-D           0.0        1</span></span>
<span><span class="co">## 8  MYR-GB-12-D           0.0        2</span></span>
<span><span class="co">## 9  MYR-GB-01-R           0.2        1</span></span>
<span><span class="co">## 10 MYR-GB-05-R           0.2        1</span></span>
<span><span class="co">## 11 MYR-GB-09-R           0.2        1</span></span>
<span><span class="co">## 12 MYR-GB-12-R           0.2        4</span></span>
<span><span class="co">## 13 MYR-GB-01-D           0.2        1</span></span>
<span><span class="co">## 14 MYR-GB-05-D           0.2        1</span></span>
<span><span class="co">## 15 MYR-GB-09-D           0.2        1</span></span>
<span><span class="co">## 16 MYR-GB-12-D           0.2        4</span></span>
<span><span class="co">## 17 MYR-GB-01-R           0.4        3</span></span>
<span><span class="co">## 18 MYR-GB-05-R           0.4        3</span></span>
<span><span class="co">## 19 MYR-GB-09-R           0.4        2</span></span>
<span><span class="co">## 20 MYR-GB-12-R           0.4        5</span></span>
<span><span class="co">## 21 MYR-GB-01-D           0.4        3</span></span>
<span><span class="co">## 22 MYR-GB-05-D           0.4        3</span></span>
<span><span class="co">## 23 MYR-GB-09-D           0.4        2</span></span>
<span><span class="co">## 24 MYR-GB-12-D           0.4        5</span></span>
<span><span class="co">## 25 MYR-GB-01-R           0.6        5</span></span>
<span><span class="co">## 26 MYR-GB-05-R           0.6        5</span></span>
<span><span class="co">## 27 MYR-GB-09-R           0.6        5</span></span>
<span><span class="co">## 28 MYR-GB-12-R           0.6        5</span></span>
<span><span class="co">## 29 MYR-GB-01-D           0.6        5</span></span>
<span><span class="co">## 30 MYR-GB-05-D           0.6        5</span></span>
<span><span class="co">## 31 MYR-GB-09-D           0.6        5</span></span>
<span><span class="co">## 32 MYR-GB-12-D           0.6        5</span></span></code></pre>
<p>We can see the suitability code indicates the input data is
increasing <em>unsuitable</em> as the temperature increases beyond 0.2
degrees. It appears we may be extrapolating beyond what the training
data can reasonably allow. Therefore, there is low confidence in this
simulation.</p>
</div>
<div class="section level3">
<h3 id="summary">Summary<a class="anchor" aria-label="anchor" href="#summary"></a>
</h3>
<p>Although this example has no conclusive results, hopefully it shows
how input data can be simulated to predict different scenarios. For
instance, we could run a similar analysis to investigate the impact of
changes to other predictive variables such as discharge.</p>
</div>
  </main><aside class="col-md-3"><nav id="toc"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p></p>
<p>Developed by Maybin Muyeba, Tim Foster, Tim Loveday.</p>
</div>

<div class="pkgdown-footer-right">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.7.</p>
</div>

    </footer>
</div>

  

  

  </body>
</html>
